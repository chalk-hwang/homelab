identity_providers:
  oidc:
    jwks:
      - key: |
          {{- fileContent "/run/secrets/authelia_identity_providers_oidc_jwks_key" | nindent 10 }}
    cors:
      endpoints:
        - authorization
        - token
        - revocation
        - introspection
        - userinfo
      allowed_origins:
        - "*"
    clients:
      - client_id: tailscale # FIXME   
        client_name: 'Tailscale'
        client_secret: '{{ fileContent "/run/secrets/oidc_tailscale_client_secret" }}' # FIXME
        redirect_uris:
          - https://login.tailscale.com/a/oauth_response
        authorization_policy: 'two_factor'
        scopes:
          - openid
          - email
          - profile
      - client_id: immich
        client_name: 'Immich'
        client_secret: '{{ fileContent "/run/secrets/oidc_immich_client_secret" }}'
        public: false
        authorization_policy: 'two_factor'
        redirect_uris:
          - 'https://photos.${TS_DOMAIN}/auth/login'
          - 'https://photos.${TS_DOMAIN}/user-settings'
          - 'https://photos.${BASE_DOMAIN}/auth/login'
          - 'https://photos.${BASE_DOMAIN}/user-settings'
          - 'app.immich:///oauth-callback'
        scopes:
          - 'openid'
          - 'profile'
          - 'email'
        userinfo_signed_response_alg: 'none'
      - client_id: 'portainer'
        client_name: 'Portainer'
        client_secret: '{{ fileContent "/run/secrets/oidc_portainer_client_secret" }}'
        public: false
        authorization_policy: 'two_factor'
        redirect_uris:
          - 'https://portainer.${BASE_DOMAIN}'
          - 'https://portainer.${TS_DOMAIN}'
        scopes:
          - 'openid'
          - 'profile'
          - 'groups'
          - 'email'
        userinfo_signed_response_alg: 'none'

# - authorization_policy: two_factor
#   client_id: $${GRAFANA_OAUTH_OIDC_CLIENT_ID}
#   client_name: Grafana
#   client_secret: $${GRAFANA_OAUTH_OIDC_CLIENT_SECRET_DIGEST}
#   pre_configured_consent_duration: 1y
#   public: false
#   redirect_uris: ["https://grafana.${BASE_DOMAIN}/login/generic_oauth"]
#   scopes: ["openid", "profile", "groups", "email"]
#   userinfo_signed_response_alg: none
# - authorization_policy: two_factor
#   client_id: $${MINIO_OAUTH_OIDC_CLIENT_ID}
#   client_name: Minio
#   client_secret: $${MINIO_OAUTH_OIDC_CLIENT_SECRET_DIGEST}
#   pre_configured_consent_duration: 1y e e
#   public: false
#   redirect_uris: ["https://minio.${BASE_DOMAIN}/oauth_callback"]
#   scopes: ["openid", "profile", "groups", "email"]
# The username and password of the admin or service user.
# userinfo_signed_response_alg: none
# cors:
#   allowed_origins_from_client_redirect_uris: true
#   endpoints: ["authorization", "token", "revocation", "introspection"]
# - client_name: Immich
#   client_id: $${IMMICH_OAUTH_OIDC_CLIENT_ID}
#   client_secret: "$${IMMICH_OAUTH_OIDC_CLIENT_SECRET_DIGEST}"
#   public: false
#   authorization_policy: 'two_factor'
#   redirect_uris:
#   - 'https://photos.${BASE_DOMAIN}/auth/login'
#   - 'https://photos.${BASE_DOMAIN}/user-settings'
#   - 'app.immich:/'
#   scopes:
#   - 'openid'
#   - 'profile'
#   - 'email'
#   userinfo_signed_response_alg: 'none'
